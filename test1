Folder structure
cypress/
  config/
    local.json
    dev.json
    qa.json
  e2e/
    smoke/
      funding.routes.smoke.cy.ts
  support/
    e2e.ts
    commands.ts
    app/
      types.ts
      routes.ts
      context.ts
      url.ts
      route-filter.ts
      route-runner.ts
  tsconfig.json
cypress.config.ts
README.cypress.md
package.json

1) package.json scripts

If you use cross-env, install it: npm i -D cross-env

{
  "devDependencies": {
    "cypress": "^14.0.0",
    "cross-env": "^7.0.3",
    "typescript": "^5.0.0"
  },
  "scripts": {
    "cy:open:local": "cross-env CYPRESS_ENV=local cypress open",
    "cy:run:local":  "cross-env CYPRESS_ENV=local cypress run",
    "cy:run:dev":    "cross-env CYPRESS_ENV=dev cypress run",
    "cy:run:qa":     "cross-env CYPRESS_ENV=qa cypress run",

    "cy:run:dev:override": "cross-env CYPRESS_ENV=dev cypress run --env loanAppGk=123456789,contextType=DEV1"
  }
}

2) Env config files
cypress/config/local.json
{
  "baseUrl": "http://localhost:4200",
  "env": {
    "loanAppGk": "10000001",
    "contextType": "LOCAL"
  }
}

cypress/config/dev.json
{
  "baseUrl": "https://dev.yourcompany.com",
  "env": {
    "loanAppGk": "20000002",
    "contextType": "DEV1"
  }
}

cypress/config/qa.json
{
  "baseUrl": "https://qa.yourcompany.com",
  "env": {
    "loanAppGk": "30000003",
    "contextType": "QA1"
  }
}


Cypress config is driven from cypress.config.ts (Cypress docs). 
Cypress Documentation

You can also override baseUrl via OS env var like CYPRESS_BASE_URL=... (Cypress docs). 
Cypress Documentation

3) Cypress config with env loader
cypress.config.ts
import { defineConfig } from 'cypress';
import fs from 'node:fs';
import path from 'node:path';

type EnvFile = {
  baseUrl: string;
  env?: Record<string, any>;
};

function loadEnvFile(envName: string): EnvFile {
  const p = path.resolve(__dirname, `cypress/config/${envName}.json`);
  if (!fs.existsSync(p)) throw new Error(`Missing Cypress env config: ${p}`);
  return JSON.parse(fs.readFileSync(p, 'utf-8')) as EnvFile;
}

export default defineConfig({
  video: false,
  screenshotOnRunFailure: true,
  chromeWebSecurity: true,

  // reasonable defaults; override if your app is slow in QA
  defaultCommandTimeout: 10_000,
  pageLoadTimeout: 60_000,
  requestTimeout: 30_000,
  responseTimeout: 30_000,

  retries: {
    runMode: 1,
    openMode: 0
  },

  reporter: 'spec',

  e2e: {
    specPattern: 'cypress/e2e/**/*.cy.ts',
    supportFile: 'cypress/support/e2e.ts',

    setupNodeEvents(on, config) {
      const envName =
        (process.env.CYPRESS_ENV as string) ||
        (config.env?.envName as string) ||
        'local';

      const envFile = loadEnvFile(envName);

      // allow OS-level override (CYPRESS_BASE_URL) without editing files
      const baseUrlOverride =
        (process.env.CYPRESS_BASE_URL as string) ||
        (process.env.CYPRESS_baseUrl as string);

      config.baseUrl = baseUrlOverride || envFile.baseUrl;

      // merge env: CLI --env > config.env > env file
      config.env = {
        ...envFile.env,
        ...config.env,
        envName
      };

      return config;
    }
  }
});

4) Cypress TypeScript project config
cypress/tsconfig.json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2022", "DOM"],
    "types": ["cypress", "node"],
    "moduleResolution": "Bundler",
    "strict": true,
    "skipLibCheck": true
  },
  "include": ["**/*.ts"]
}

5) Common types + route registry
cypress/support/app/types.ts
export type FundingContext = {
  loanAppGk: string;
  contextType: string;
};

export type WaitOn = {
  alias: string;
  method?: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE';
  url: string | RegExp;
  timeoutMs?: number;
};

export type AppRoute = {
  id: string;
  path: string;

  // page-ready assertion (required)
  readyByCy: string;

  // optional: network calls to wait on for stability
  waitOn?: WaitOn[];

  // optional: tags to filter routes in CI (smoke, funding, etc.)
  tags?: string[];
};

cypress/support/app/routes.ts
import { AppRoute } from './types';

export const FUNDING_ROUTES: AppRoute[] = [
  {
    id: 'returnreasons',
    path: '/funding/returnreasons',
    readyByCy: 'page-returnreasons',
    tags: ['smoke', 'funding']
  },
  {
    id: 'commodity',
    path: '/funding/commodity',
    readyByCy: 'page-commodity',
    tags: ['smoke', 'funding']
  },
  {
    id: 'booking',
    path: '/funding/booking',
    readyByCy: 'page-booking',
    tags: ['smoke', 'funding']
  },
  {
    id: 'prefundinfo',
    path: '/funding/prefundinfo',
    readyByCy: 'page-prefundinfo',
    tags: ['smoke', 'funding']
  }
];

6) Context resolver (run params override defaults)
cypress/support/app/context.ts
import { FundingContext } from './types';

export function resolveFundingContext(overrides?: Partial<FundingContext>): FundingContext {
  const loanAppGk = (overrides?.loanAppGk ?? Cypress.env('loanAppGk')) as string;
  const contextType = (overrides?.contextType ?? Cypress.env('contextType')) as string;

  if (!loanAppGk || !contextType) {
    throw new Error(
      `Missing context. Provide loanAppGk/contextType in env config or via CLI: --env loanAppGk=...,contextType=...`
    );
  }

  return { loanAppGk, contextType };
}

7) URL builder (always injects loanAppGk + contextType)

This merges params correctly even if you later add routes with their own query string.

cypress/support/app/url.ts
import { FundingContext } from './types';

export function buildUrlWithFundingContext(
  path: string,
  ctx: FundingContext,
  extra?: Record<string, string>
) {
  const normalized = path.startsWith('/') ? path : `/${path}`;

  const [base, query = ''] = normalized.split('?');
  const params = new URLSearchParams(query);

  params.set('loanAppGk', ctx.loanAppGk);
  params.set('contextType', ctx.contextType);

  if (extra) {
    for (const [k, v] of Object.entries(extra)) {
      params.set(k, v);
    }
  }

  const q = params.toString();
  return q ? `${base}?${q}` : base;
}

8) Optional route filtering (so you can scale to 100+)

Supports:

--env tags=smoke (only routes having that tag)

--env include=booking,prefundinfo (only these route ids)

--env exclude=prefundinfo (skip these)

cypress/support/app/route-filter.ts
import { AppRoute } from './types';

function csvEnv(name: string): string[] {
  const raw = (Cypress.env(name) as string | undefined) ?? '';
  return raw
    .split(',')
    .map(s => s.trim())
    .filter(Boolean);
}

export function filterRoutes(all: AppRoute[]): AppRoute[] {
  const tags = csvEnv('tags');
  const include = csvEnv('include');
  const exclude = new Set(csvEnv('exclude'));

  let routes = [...all];

  if (tags.length) {
    routes = routes.filter(r => (r.tags ?? []).some(t => tags.includes(t)));
  }

  if (include.length) {
    const includeSet = new Set(include);
    routes = routes.filter(r => includeSet.has(r.id));
  }

  routes = routes.filter(r => !exclude.has(r.id));
  return routes;
}

9) Route runner (fast + stable)
cypress/support/app/route-runner.ts
import { AppRoute, FundingContext } from './types';
import { resolveFundingContext } from './context';
import { buildUrlWithFundingContext } from './url';

export function visitAndAssertRoute(route: AppRoute, overrides?: Partial<FundingContext>) {
  const ctx = resolveFundingContext(overrides);

  // Register intercepts BEFORE visiting to avoid missing initial calls
  (route.waitOn ?? []).forEach(w => {
    cy.intercept(w.method ?? 'GET', w.url).as(w.alias);
  });

  cy.visit(buildUrlWithFundingContext(route.path, ctx));

  // Optional waits for deterministic smoke (use only where needed)
  (route.waitOn ?? []).forEach(w => {
    cy.wait(`@${w.alias}`, { timeout: w.timeoutMs ?? 30_000 });
  });

  // Page-ready assertion
  cy.get(`[data-cy="${route.readyByCy}"]`, { timeout: 30_000 }).should('be.visible');
}

10) Commands (keeps tests clean)
cypress/support/commands.ts
import { AppRoute, FundingContext } from './app/types';
import { visitAndAssertRoute } from './app/route-runner';

declare global {
  namespace Cypress {
    interface Chainable {
      getByCy(value: string): Chainable<JQuery<HTMLElement>>;
      smokeRoute(route: AppRoute, overrides?: Partial<FundingContext>): Chainable<void>;
    }
  }
}

Cypress.Commands.add('getByCy', (value: string) => {
  return cy.get(`[data-cy="${value}"]`);
});

Cypress.Commands.add('smokeRoute', (route: AppRoute, overrides?: Partial<FundingContext>) => {
  visitAndAssertRoute(route, overrides);
});

cypress/support/e2e.ts
import './commands';

// Don't blindly suppress errors. Fix the app.
// Use this only if you have known noisy exceptions you can't control.
Cypress.on('uncaught:exception', () => false);

11) Smoke spec (your 4 screens)
cypress/e2e/smoke/funding.routes.smoke.cy.ts
import { FUNDING_ROUTES } from '../../support/app/routes';
import { filterRoutes } from '../../support/app/route-filter';

describe('Smoke: Funding routes', () => {
  const routes = filterRoutes(FUNDING_ROUTES);

  routes.forEach((r) => {
    it(`loads ${r.id}`, () => {
      cy.smokeRoute(r); // uses CLI overrides if provided, else env defaults
    });
  });

  it('can change loanAppGk mid-run (query param injection)', () => {
    cy.smokeRoute(routes[0], { loanAppGk: '99999999' });
    cy.smokeRoute(routes[1], { loanAppGk: '88888888', contextType: 'QA1' });
  });
});

README (markdown)

Create this file: README.cypress.md

# Cypress E2E Smoke Setup (Angular 20 + Cypress 14)

This setup runs route smoke tests against:
- local (`http://localhost:4200`)
- dev
- qa

All routes are visited with required query params:
- `loanAppGk`
- `contextType`

## Non-negotiable app requirement (avoid flaky tests)
Each route must expose a stable page-ready marker:
- Return Reasons page: `data-cy="page-returnreasons"`
- Commodity page: `data-cy="page-commodity"`
- Booking page: `data-cy="page-booking"`
- PrefundInfo page: `data-cy="page-prefundinfo"`

If you don't add these `data-cy` markers, your smoke tests will be brittle and expensive to maintain.

---

## Install
```bash
npm i -D cypress@^14 typescript cross-env

Config files

Environment configs live here:

cypress/config/local.json

cypress/config/dev.json

cypress/config/qa.json

Each file defines:

baseUrl

default env.loanAppGk and env.contextType

cypress.config.ts loads the correct JSON based on CYPRESS_ENV.

Run locally
npm run cy:open:local
npm run cy:run:local

Run in dev / qa
npm run cy:run:dev
npm run cy:run:qa

Override loanAppGk/contextType at runtime

CLI overrides win over config defaults:

npm run cy:run:dev -- --env loanAppGk=123456789,contextType=DEV1

Override baseUrl without changing files

You can override baseUrl via OS env var:

CYPRESS_BASE_URL=https://some-env.company.com npm run cy:run:qa

Route registry (single source of truth)

Funding routes are defined in:

cypress/support/app/routes.ts

To add a new screen:

Add route entry:

{ id: 'newscreen', path: '/funding/newscreen', readyByCy: 'page-newscreen', tags: ['smoke','funding'] }


Add data-cy="page-newscreen" to that screen's page root element in Angular.

Optional: add waitOn if the page needs a key API call to finish before it is stable:

waitOn: [{ alias: 'load', url: /\/api\/funding\/newscreen/ }]

Filtering (for large suites)

Supported filters:

--env tags=smoke (only routes that include the tag)

--env include=booking,prefundinfo (only these ids)

--env exclude=prefundinfo (skip these ids)

Examples:

npm run cy:run:qa -- --env tags=smoke
npm run cy:run:qa -- --env include=booking,prefundinfo
npm run cy:run:qa -- --env exclude=prefundinfo

How query params are injected

Every visit goes through:

resolveFundingContext() (reads Cypress.env('loanAppGk') + Cypress.env('contextType'))

buildUrlWithFundingContext() (merges/injects params into the URL)

visitAndAssertRoute() (visit + optional waits + ready assertion)

Files:

cypress/support/app/context.ts

cypress/support/app/url.ts

cypress/support/app/route-runner.ts

CI notes (basic)

Prefer cypress run in CI

Keep selectors stable (data-cy)

Only use waitOn when needed; over-waiting slows everything down.

Troubleshooting
Tests fail only in QA

Increase pageLoadTimeout and responseTimeout in cypress.config.ts

Add waitOn for the API call that defines page readiness

Page-ready selector not found

Ensure the route actually renders the marker:

<div data-cy="page-booking">...</div>

Ensure it is visible (not display:none behind a spinner)
