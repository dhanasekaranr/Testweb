OAuth2/OIDC in Angular 19 — End-to-End Developer Guide

This README gives you a clean, reliable, production-ready flow for:

Code flow with refresh token

Deep-link restore after login (no flicker, no / or ?code&state)

Per-route context policy (both | ctxOnly | none)

Clean URLs (strip loanno / contexttype from the address bar)

Single-flight refresh and optional short-expiry test harness

Navigation telemetry (success/fail)

The examples use standalone files/services; adapt names/paths as needed.

1) High-Level Architecture

Actors

AuthService — wraps your OAuth client; exposes init(), accessToken(), refresh logic, and a one-time pendingTarget handoff.

BootService — orchestrates first run via APP_INITIALIZER (awaited).

PostAuthNavigator — reads saved deep link from storage/state, seeds context, and performs a one-time deep-link hop (and URL cleanup).

UserService — owns context (loanno, contexttype) as signals/behavior + robust readParams(url) (handles encoded/hash/relative).

AuthGuard — enforces auth + context policy, prefers pendingTarget once, and removes context params from URL.

(Optional) AuthMatchGuard — same policy as AuthGuard but for canMatch to block heavy lazy-loads earlier.

MonitoringService + NavTelemetryService — Router-level telemetry (once per navigation).

Storage

sessionStorage['oauth:return_to'] — holds return URL across IdP round-trip (per-tab, cleared on read).
